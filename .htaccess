RewriteEngine On

# Rediriger tout vers le script PHP qui gère les minuscules pour empêcher la casses dans les URL
RewriteCond %{REQUEST_URI} [A-Z]
RewriteRule ^(.*)$ /rewrite.php [L]

# Supprimer le / final des URLs
RewriteCond %{REQUEST_URI} .+/$
RewriteRule ^(.+)/$ /$1 [R=301,L]

# Supprimer l'extension .html de l'URL affichée
RewriteCond %{THE_REQUEST} "\s/+(.+?)\.html[\s?]" [NC]
RewriteRule ^(.+)\.html$ /$1 [R=301,L]

# Supprimer l'extension .php de l'URL affichée
RewriteCond %{THE_REQUEST} "\s/+(.+?)\.php[\s?]" [NC]
RewriteRule ^(.+)\.php$ /$1 [R=301,L]

RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirection vers la version sans www
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [L,R=301]

# Faire correspondre les fichiers .html quand l'extension est absente dans l'URL
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^([^\.]+)$ /$1.html [L]

DirectoryIndex index.html
DirectorySlash Off
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.*[^/])$ /$1/index.html [L]

# Redirection des erreur 404 et 500
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html
ErrorDocument 502 /500.html
ErrorDocument 503 /500.html
ErrorDocument 504 /500.html

# Règles de sécurités
Header set X-Frame-Options "DENY"
Header set X-XSS-Protection "1; mode=block"
Header set X-Content-Type-Options "nosniff"
#Header set Content-Security-Policy "default-src 'self'; font-src 'self' https://fonts.gstatic.com; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; script-src 'self'; connect-src 'self' https://api.mcsrvstat.us; frame-src 'self' https://www.youtube.com"
Header set Strict-Transport-Security "max-age=31536000; includeSubDomains"
Header set Referrer-Policy "no-referrer"
Header set Permissions-Policy "geolocation=(), camera=(), microphone=()"

<Files "config.php">
    Require all denied
</Files>